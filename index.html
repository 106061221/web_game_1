<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Blackjack Mobile</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        /* 背景網格 */
        body::before {
            content: ""; position: absolute; width: 200%; height: 200%; top: -50%; left: -50%;
            background-image: linear-gradient(#111 1px, transparent 1px), linear-gradient(90deg, #111 1px, transparent 1px);
            background-size: 40px 40px; transform: perspective(500px) rotateX(60deg); z-index: -1;
        }
        #lobby, #game-container { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #game-container { display: none; background: radial-gradient(circle, rgba(0,20,40,1) 0%, rgba(0,0,0,1) 100%); }
        
        .menu-btn { 
            background: transparent; color: #0ff; border: 2px solid #0ff; padding: 20px 60px; font-size: 24px; font-weight: bold; 
            border-radius: 5px; box-shadow: 0 0 15px #0ff; text-transform: uppercase; cursor: pointer; transition: 0.2s;
        }
        .menu-btn:active { transform: scale(0.95); background: rgba(0,255,255,0.1); }

        .controls { position: absolute; bottom: 40px; display: flex; gap: 15px; width: 90%; justify-content: center; }
        .ctrl-btn { 
            flex: 1; background: transparent; color: #f0f; border: 2px solid #f0f; padding: 18px 0; border-radius: 8px; 
            font-size: 18px; font-weight: bold; text-transform: uppercase; box-shadow: 0 0 10px #f0f; cursor: pointer;
        }
        .ctrl-btn:active:not(:disabled) { transform: scale(0.9); background: rgba(255,0,255,0.1); }
        .ctrl-btn:disabled { opacity: 0.2; box-shadow: none; border-color: #444; color: #444; }

        #status { position: absolute; top: 12%; width: 100%; text-align: center; font-size: 26px; font-weight: bold; color: #fff; text-shadow: 0 0 10px #fff, 0 0 20px #0ff; z-index: 5; }
        canvas { width: 100%; height: 100%; display: block; }
    </style>
</head>
<body>
    <div id="lobby">
        <button class="menu-btn" onclick="startGame()">Start Game</button>
    </div>
    <div id="game-container">
        <div id="status">BLACKJACK</div>
        <canvas id="canvas"></canvas>
        <div class="controls">
            <button id="dealBtn" class="ctrl-btn" onclick="deal()">Deal</button>
            <button id="hitBtn" class="ctrl-btn" onclick="hit()" disabled>Hit</button>
            <button id="standBtn" class="ctrl-btn" onclick="stand()" disabled>Stand</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status');
        const dealBtn = document.getElementById('dealBtn');
        const hitBtn = document.getElementById('hitBtn');
        const standBtn = document.getElementById('standBtn');

        let deck = [], pHand = [], dHand = [];
        let cardW, cardH, scale;

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            scale = (canvas.width / 400);
            cardW = 70 * scale;
            cardH = 100 * scale;
            ctx.scale(dpr, dpr);
        }

        function initDeck() {
            const vals = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
            deck = [];
            for(let i=0; i<4; i++) vals.forEach(v => deck.push({v, hidden: false}));
            deck.sort(() => Math.random() - 0.5);
        }

        function getScore(hand) {
            let score = 0, aces = 0;
            hand.forEach(c => {
                if(c.hidden) return;
                if(c.v === 'A') { aces++; score += 11; }
                else if(['J','Q','K'].includes(c.v)) score += 10;
                else score += parseInt(c.v);
            });
            while(score > 21 && aces > 0) { score -= 10; aces--; }
            return score;
        }

        function startGame() {
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            resize();
            initDeck();
            requestAnimationFrame(draw);
        }

        function deal() {
            if(deck.length < 10) initDeck();
            pHand = [deck.pop(), deck.pop()];
            dHand = [deck.pop(), { ...deck.pop(), hidden: true }];
            dealBtn.disabled = true;
            hitBtn.disabled = false;
            standBtn.disabled = false;
            statusEl.innerText = "YOUR SCORE: " + getScore(pHand);
        }

        function hit() {
            pHand.push(deck.pop());
            const s = getScore(pHand);
            statusEl.innerText = "YOUR SCORE: " + s;
            if(s > 21) { statusEl.innerText = "BUST! LOSE"; endGame(); }
        }

        function stand() {
            dHand[1].hidden = false;
            while(getScore(dHand) < 17) dHand.push(deck.pop());
            const ps = getScore(pHand), ds = getScore(dHand);
            if(ds > 21 || ps > ds) statusEl.innerText = "YOU WIN!";
            else if(ps < ds) statusMsg = statusEl.innerText = "DEALER WINS";
            else statusEl.innerText = "PUSH";
            endGame();
        }

        function endGame() {
            hitBtn.disabled = true;
            standBtn.disabled = true;
            dealBtn.disabled = false;
        }

        function renderCard(c, x, y, neonColor) {
            ctx.save();
            ctx.translate(x, y);
            
            // 霓虹邊框
            ctx.strokeStyle = c.hidden ? '#444' : neonColor;
            ctx.lineWidth = 3;
            ctx.shadowBlur = c.hidden ? 0 : 15;
            ctx.shadowColor = neonColor;
            
            ctx.beginPath();
            ctx.roundRect(-cardW/2, -cardH/2, cardW, cardH, 5);
            ctx.stroke();
            
            // 卡片內底色（半透明深色）
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fill();
            
            if(!c.hidden) {
                ctx.fillStyle = '#fff';
                ctx.font = `bold ${28 * (scale/2.5)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(c.v, 0, 0);
            } else {
                ctx.fillStyle = '#333';
                ctx.font = `italic ${20 * (scale/2.5)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.fillText("?", 0, 0);
            }
            ctx.restore();
        }

        function draw() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            ctx.clearRect(0, 0, w, h);

            // 莊家牌 (洋紅霓虹)
            dHand.forEach((c, i) => {
                const x = (w/2 - (dHand.length-1)*25) + (i*50);
                renderCard(c, x, h * 0.3, '#f0f');
            });

            // 玩家牌 (青色霓虹)
            pHand.forEach((c, i) => {
                const x = (w/2 - (pHand.length-1)*25) + (i*50);
                renderCard(c, x, h * 0.65, '#0ff');
            });

            requestAnimationFrame(draw);
        }

        window.addEventListener('resize', resize);
        // 滑鼠與觸控點擊通用處理
        window.addEventListener('mousedown', (e) => { /* 點擊反饋已由 CSS active 處理 */ });
    </script>
</body>
</html>
